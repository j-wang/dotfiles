#!/bin/sh
# Prefer local ssh-keygen; fall back to 1Password only if its binary exists (macOS).
# No 1Password fallback on Linux unless you add a path below.

# Try local first
if command -v ssh-keygen >/dev/null 2>&1; then
  if ssh-keygen "$@"; then
    exit 0
  fi
fi

# macOS 1Password app bundle path
OP_SSH_SIGN="/Applications/1Password.app/Contents/MacOS/op-ssh-sign"

# Optional: add Linux path if you *do* ever want fallback there
# e.g., OP_SSH_SIGN="/usr/local/bin/op-ssh-sign"

if [ -x "$OP_SSH_SIGN" ]; then
  exec "$OP_SSH_SIGN" "$@"
fi

echo "git-ssh-signer: local ssh-keygen failed and 1Password signer not found." >&2
exit 1
